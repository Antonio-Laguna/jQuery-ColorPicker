(function(c){var q=65,v={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:!0,flat:!1},h=function(a,b){var e=HSBToRGB(a);c(b).data("colorpicker").fields.eq(1).val(e.r).end().eq(2).val(e.g).end().eq(3).val(e.b).end()},k=function(a,b){c(b).data("colorpicker").fields.eq(4).val(a.h).end().eq(5).val(a.s).end().eq(6).val(a.b).end()},j=function(a,b){c(b).data("colorpicker").fields.eq(0).val(HSBToHex(a)).end()},
l=function(a,b){c(b).data("colorpicker").selector.css("backgroundColor","#"+HSBToHex({h:a.h,s:100,b:100}));c(b).data("colorpicker").selectorIndic.css({left:parseInt(150*a.s/100,10),top:parseInt(150*(100-a.b)/100,10)})},m=function(a,b){c(b).data("colorpicker").hue.css("top",parseInt(150-150*a.h/360,10))},p=function(a,b){c(b).data("colorpicker").currentColor.css("backgroundColor","#"+HSBToHex(a))},n=function(a,b){c(b).data("colorpicker").newColor.css("backgroundColor","#"+HSBToHex(a))},w=function(a){a=
a.charCode||a.keyCode||-1;if(a>q&&90>=a||32===a)return!1;!0===c(this).parent().parent().data("colorpicker").livePreview&&f.apply(this)},f=function(a){var b=c(this).parent().parent(),e;0<this.parentNode.className.indexOf("_hex")?b.data("colorpicker").color=e=HexToHSB(fixHex(this.value)):0<this.parentNode.className.indexOf("_hsb")?b.data("colorpicker").color=e=fixHSB({h:parseInt(b.data("colorpicker").fields.eq(4).val(),10),s:parseInt(b.data("colorpicker").fields.eq(5).val(),10),b:parseInt(b.data("colorpicker").fields.eq(6).val(),
10)}):b.data("colorpicker").color=e=RGBToHSB(fixRGB({r:parseInt(b.data("colorpicker").fields.eq(1).val(),10),g:parseInt(b.data("colorpicker").fields.eq(2).val(),10),b:parseInt(b.data("colorpicker").fields.eq(3).val(),10)}));a&&(h(e,b.get(0)),j(e,b.get(0)),k(e,b.get(0)));l(e,b.get(0));m(e,b.get(0));n(e,b.get(0));b.data("colorpicker").onChange.apply(b,[e,HSBToHex(e),HSBToRGB(e)])},x=function(){c(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus")},z=function(){q=
0<this.parentNode.className.indexOf("_hex")?70:65;c(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus");c(this).parent().addClass("colorpicker_focus")},A=function(a){var b=c(this).parent().find("input").focus();a={el:c(this).parent().addClass("colorpicker_slider"),max:0<this.parentNode.className.indexOf("_hsb_h")?360:0<this.parentNode.className.indexOf("_hsb")?100:255,y:a.pageY,field:b,val:parseInt(b.val(),10),preview:c(this).parent().parent().data("colorpicker").livePreview};
c(document).on("mouseup",a,r);c(document).on("mousemove",a,s)},s=function(a){a.data.field.val(Math.max(0,Math.min(a.data.max,parseInt(a.data.val+a.pageY-a.data.y,10))));a.data.preview&&f.apply(a.data.field.get(0),[!0]);return!1},r=function(a){f.apply(a.data.field.get(0),[!0]);a.data.el.removeClass("colorpicker_slider").find("input").focus();c(document).off("mouseup",r);c(document).off("mousemove",s);return!1},B=function(){var a={cal:c(this).parent(),y:c(this).offset().top};a.preview=a.cal.data("colorpicker").livePreview;
c(document).on("mouseup",a,t);c(document).on("mousemove",a,u)},u=function(a){f.apply(a.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,a.pageY-a.data.y)))/150,10)).get(0),[a.data.preview]);return!1},t=function(a){h(a.data.cal.data("colorpicker").color,a.data.cal.get(0));j(a.data.cal.data("colorpicker").color,a.data.cal.get(0));c(document).off("mouseup",t);c(document).off("mousemove",u);return!1},C=function(a){y=c(this).offset().top;preview=a.data.cal.data("colorpicker").livePreview;
f.apply(a.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,a.pageY-y)))/150,10)).get(0),[preview])};downSelector=function(a){var b={cal:c(this).parent(),pos:c(this).offset()};b.preview=b.cal.data("colorpicker").livePreview;c(document).on("mouseup",b,upSelector);c(document).on("mousemove",b,moveSelector);c(".colorpicker_color").one("click",b,moveSelector);a.data=b;moveSelector(a)};moveSelector=function(a){f.apply(a.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*
(150-Math.max(0,Math.min(150,a.pageY-a.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,a.pageX-a.data.pos.left))/150,10)).get(0),[a.data.preview]);return!1};upSelector=function(a){c(this).parent();c(this).offset();h(a.data.cal.data("colorpicker").color,a.data.cal.get(0));j(a.data.cal.data("colorpicker").color,a.data.cal.get(0));c(document).off("mouseup",upSelector);c(document).off("mousemove",moveSelector);return!1};enterSubmit=function(){c(this).addClass("colorpicker_focus")};
leaveSubmit=function(){c(this).removeClass("colorpicker_focus")};clickSubmit=function(){var a=c(this).parent(),b=a.data("colorpicker").color;a.data("colorpicker").origColor=b;p(b,a.get(0));a.data("colorpicker").onSubmit(b,HSBToHex(b),HSBToRGB(b),a.data("colorpicker").el,a.data("colorpicker").parent)};show=function(){var a=c("#"+c(this).data("colorpickerId"));a.data("colorpicker").onBeforeShow.apply(this,[a.get(0)]);var b=c(this).offset(),e=getViewport(),d=b.top+this.offsetHeight,b=b.left;d+176>e.t+
e.h&&(d-=this.offsetHeight+176);b+356>e.l+e.w&&(b-=356);a.css({left:b+"px",top:d+"px"});!1!=a.data("colorpicker").onShow.apply(this,[a.get(0)])&&a.show();c(document).on("mousedown",{cal:a},hide);return!1};hide=function(a){isChildOf(a.data.cal.get(0),a.target,a.data.cal.get(0))||(!1!=a.data.cal.data("colorpicker").onHide.apply(this,[a.data.cal.get(0)])&&a.data.cal.hide(),c(document).off("mousedown",hide))};isChildOf=function(a,b,c){if(a===b)return!0;if(a.contains)return a.contains(b);if(a.compareDocumentPosition)return!!(a.compareDocumentPosition(b)&
16);for(b=b.parentNode;b&&b!==c;){if(b===a)return!0;b=b.parentNode}return!1};getViewport=function(){var a="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(a?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(a?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(a?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(a?document.documentElement.clientHeight:document.body.clientHeight)}};fixHSB=
function(a){return{h:Math.min(360,Math.max(0,a.h)),s:Math.min(100,Math.max(0,a.s)),b:Math.min(100,Math.max(0,a.b))}};fixRGB=function(a){return{r:Math.min(255,Math.max(0,a.r)),g:Math.min(255,Math.max(0,a.g)),b:Math.min(255,Math.max(0,a.b))}};fixHex=function(a){var b=6-a.length;if(0<b){for(var c=[],d=0;d<b;d++)c.push("0");c.push(a);a=c.join("")}return a};HexToRGB=function(a){a=parseInt(-1<a.indexOf("#")?a.substring(1):a,16);return{r:a>>16,g:(a&65280)>>8,b:a&255}};HexToHSB=function(a){return RGBToHSB(HexToRGB(a))};
RGBToHSB=function(a){var b={h:0,s:0,b:0},c=Math.min(a.r,a.g,a.b),d=Math.max(a.r,a.g,a.b),c=d-c;b.b=d;b.s=0!=d?255*c/d:0;b.h=0!=b.s?a.r===d?(a.g-a.b)/c:a.g===d?2+(a.b-a.r)/c:4+(a.r-a.g)/c:-1;b.h*=60;0>b.h&&(b.h+=360);b.s*=100/255;b.b*=100/255;return b};HSBToRGB=function(a){var b,c,d;b=Math.round(a.h);var g=Math.round(255*a.s/100);a=Math.round(255*a.b/100);if(0==g)b=c=d=a;else{var g=(255-g)*a/255,f=(a-g)*(b%60)/60;360===b&&(b=0);60>b?(b=a,d=g,c=g+f):120>b?(c=a,d=g,b=a-f):180>b?(c=a,b=g,d=g+f):240>b?
(d=a,b=g,c=a-f):300>b?(d=a,c=g,b=g+f):360>b?(b=a,c=g,d=a-f):d=c=b=0}return{r:Math.round(b),g:Math.round(c),b:Math.round(d)}};RGBToHex=function(a){var b=[a.r.toString(16),a.g.toString(16),a.b.toString(16)];c.each(b,function(a,c){1===c.length&&(b[a]="0"+c)});return b.join("")};RGBstringToHex=function(a){function b(a){return("0"+parseInt(a,10).toString(16)).slice(-2)}if(!a)return"#FFFFFF";var c=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return c?"#"+b(c[1])+b(c[2])+b(c[3]):a};HSBToHex=function(a){return RGBToHex(HSBToRGB(a))};
restoreOriginal=function(){var a=c(this).parent(),b=a.data("colorpicker").origColor;a.data("colorpicker").color=b;h(b,a.get(0));j(b,a.get(0));k(b,a.get(0));l(b,a.get(0));m(b,a.get(0));n(b,a.get(0))};c.fn.extend({ColorPicker:function(a){a=c.extend({},v,a||{});if("string"==typeof a.color)a.color="rgb("==a.color.substring(0,4)?HexToHSB(RGBstringToHex(a.color)):HexToHSB(a.color);else if(void 0!==a.color.r&&void 0!==a.color.g&&void 0!==a.color.b)a.color=RGBToHSB(a.color);else if(void 0!==a.color.h&&void 0!==
a.color.s&&void 0!==a.color.b)a.color=fixHSB(a.color);else return this;return this.each(function(){if(!c(this).data("colorpickerId")){var b=c.extend({},a);b.origColor=a.color;var e,d=0;for(e=0===c("#colorpicker_"+d).length;!e;)d=parseInt(1E4*Math.random()),e=0===c("#colorpicker_"+d).length;e="colorpicker_"+d;c(this).data("colorpickerId",e);b.parent=c(this);d=c('<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><label for="hex">#</label><input type="text" maxlength="6" size="6" id="hex" /></div><div class="colorpicker_rgb_r colorpicker_field"><label for="rbg_r">R</label><input type="text" maxlength="3" size="3" id="rgb_r" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><label for="rbg_g">G</label><input type="text" maxlength="3" size="3" id="rgb_g" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><label for="rbg_b">B</label><input type="text" maxlength="3" size="3" id="rgb_b" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><label for="hsb_h">H</label><input type="text" maxlength="3" size="3" id="hsb_h" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><label for="hsb_s">S</label><input type="text" maxlength="3" size="3" id="hsb_s" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><label for="hsb_b">B</label><input type="text" maxlength="3" size="3" id="hsb_b" /><span></span></div><div class="colorpicker_submit"></div></div>');
d.attr("id",e).attr("data-parent",c(this).attr("id"));b.flat?d.appendTo(this).show():d.appendTo(document.body);b.fields=d.find("input").on("keyup",w).on("change",f).on("blur",x).on("focus",z);d.find("span").on("mousedown",A).end().find(">div.colorpicker_current_color").on("click",restoreOriginal);b.selector=d.find("div.colorpicker_color").on("mousedown",downSelector);b.selectorIndic=b.selector.find("div div");b.el=this;b.hue=d.find("div.colorpicker_hue div");d.find("div.colorpicker_hue").on("mousedown",
B);d.find("div.colorpicker_hue").on("mousedown",{cal:d},C);b.newColor=d.find("div.colorpicker_new_color");b.currentColor=d.find("div.colorpicker_current_color");d.data("colorpicker",b);d.find("div.colorpicker_submit").on("mouseenter",enterSubmit).on("mouseleave",leaveSubmit).on("click",clickSubmit);h(b.color,d.get(0));k(b.color,d.get(0));j(b.color,d.get(0));m(b.color,d.get(0));l(b.color,d.get(0));p(b.color,d.get(0));n(b.color,d.get(0));if(b.flat)d.css({position:"relative",display:"block"});else c(this).on(b.eventName,
show)}})},ColorPickerHide:function(){return this.each(function(){c(this).data("colorpickerId")&&c("#"+c(this).data("colorpickerId")).hide()})},ColorPickerShow:function(){return this.each(function(){c(this).data("colorpickerId")&&show.apply(this)})},ColorPickerSetColor:function(a){if("string"==typeof a)a="rgb("==a.substring(0,4)?HexToHSB(RGBstringToHex(a)):HexToHSB(a);else if(void 0!==a.r&&void 0!==a.g&&void 0!==a.b)a=RGBToHSB(a);else if(void 0!==a.h&&void 0!==a.s&&void 0!==a.b)a=fixHSB(a);else return this;
return this.each(function(){if(c(this).data("colorpickerId")){var b=c("#"+c(this).data("colorpickerId"));b.data("colorpicker").color=a;b.data("colorpicker").origColor=a;h(a,b.get(0));k(a,b.get(0));j(a,b.get(0));m(a,b.get(0));l(a,b.get(0));p(a,b.get(0));n(a,b.get(0))}})}})})(jQuery);